<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Java | Aaron Wu</title>
  <meta name="author" content="Aaron Wu">
  
  <meta name="description" content="Aaron Wu">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Aaron Wu">

  
    <meta property="og:image" content="undefined">
  

  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/cerulean.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight-default.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/comment.css" media="screen" type="text/css">
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-sham.min.js"></script>
  <![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  
    <script src="/js/marked.js"></script>
    <script src="/js/comment.js"></script>
    <script src="/js/timeago.min.js"></script>
    <script src="/js/highlight.min.js"></script>
	<script src="/js/spin.min.js"></script>
  
  <!-- analytics --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  



</head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">Aaron Wu</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
    <div class="content">
      

<!-- title -->
<div class="page-header page-header-inverse ">
  <h1 class="archive-title-tag title title-inverse ">Java</h1>
</div>

<div class="row page">
  <!-- cols -->
  
  <div class="col-md-9">
	

	  <div id="top_search"></div>

      
         <!-- display as entry -->
	     <div class="mypage">
	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-09-04 </div>
			<div class="article-title"><a href="/2017/09/04/FreeMarker模板引擎实战/" title="FreeMarker是一个模板引擎：它是一个Java库，基于模板和要改变的数据生成输出文本（HTML网页、电子邮件、配置文件、源代码等）。本文通过一个小demo来说明FreeMarker的使用方式。">FreeMarker模板引擎实战</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<p>&emsp;&emsp;FreeMarker是一个模板引擎：它是一个Java库，基于模板和要改变的数据生成输出文本（HTML网页、电子邮件、配置文件、源代码等）。<br>&emsp;&emsp;笔者在项目开发过程中遇到了FreeMarker的使用场景，因此阅读了官方的文档。本文不会记录FreeMarker各种表达式、标签和指令的使用，更加侧重于模板引擎整体的使用。</p>
<h2 id="基本概念和术语"><a href="#基本概念和术语" class="headerlink" title="基本概念和术语"></a>基本概念和术语</h2><p>&emsp;&emsp;如官方手册中所言，<code>模板+数据模型=输出</code>。在FreeMarker中，首先要定义一个文件模板，如html，将其中需要动态传值的数据通过FreeMarker中的表达式、标签或自定义标签替换。再定义数据模型，通常是通过Java中的类来封装数据。使用时后台会读取模板和数据模型，将数据嵌入模板，然后生成新的html页面，提供给我们静态化访问。  </p>
<h3 id="数据模型详解"><a href="#数据模型详解" class="headerlink" title="数据模型详解"></a>数据模型详解</h3><p>&emsp;&emsp;FreeMarker中的数据模型是一个树形的结构，如下所示:  </p>
<pre> 
(root)
  |
  +- animals
  |   |
  |   +- mouse
  |   |   |
  |   |   +- size = "small"
  |   |   |
  |   |   +- price = 50
  |   |
  |   +- elephant
  |   |   |
  |   |   +- size = "large"
  |   |   |
  |   |   +- price = 5000
  |   |
  |   +- python
  |       |
  |       +- size = "medium"
  |       |
  |       +- price = 4999
  |
  +- message = "It is a test"
  |
  +- misc
      |
      +- foo = "Something"
</pre>  

<p>&emsp;&emsp;其中有一些术语，上图中的根节点、mouse、elephant、python、misc这些非叶子结点，在上图中类似于一个目录，它们被称为<strong>hash</strong>，它们保存其他的叶子变量。<br>&emsp;&emsp;上图中保存单个值的变量，如size、price、message、foo，被称为<strong>scalar</strong>，scalar支持的数据类型为：String、数字、日期时间、布尔值。要读取scalar，可以通过“.”符号，如要读取上图中的foo，可以写成misc.foo。<br>&emsp;&emsp;如果上图中的animals目录下的mouse、elephant、python均没有具体的名字，则animals被称为<strong>sequences</strong>，sequence下的目录均为hash，但它们没有具体的名字，表示存在于一个列表中的项，可以通过索引来取到，如要取上图中的animals.python.size，也可以通过animals[2].size取到，就像Java中的列表一样。  </p>
<h2 id="模板引擎的使用"><a href="#模板引擎的使用" class="headerlink" title="模板引擎的使用"></a>模板引擎的使用</h2><h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h3><p>&emsp;&emsp;使用FreeMarker主要有以下几个步骤：</p>
<ol>
<li>创建freemarker.template.Configuration类的实例并设置其属性。Configuration类的实例是用来存储freemarer应用级设置的核心容器，它负责创建和捕获预解析的模板（即Template对象）。  </li>
<li>创建数据模型，数据模型中的hash（用来存储其他有名字的数据项）可以是Map也可以是JavaBeans，只要它拥有public的getXxx或isXxx方法。</li>
<li>获取模板文件，模板由freemarker.template.Template类的实例所表示，Template类实例通过Configuration类实例的getTemplate()方法获得。Template实例用一种解析过后的格式来存储模板，而非纯文本。如果模板文件丢失或语法错误，则getTemplate()方法将会抛出异常。Configuration实例容器会缓存Template实例，下次通过getTemplate()获取同一个模板时，不会重新解析，而是返回缓存中的同一个Template实例。  </li>
<li>将数据模型合并至模板中，并产生输出文件。通过Template实例对象的process()方法。一个Template实例对象一旦创建出来，它可以与多个数据模型进行多次合并。  </li>
</ol>
<h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><p>&emsp;&emsp;下面就对应上面相应的步骤，给出代码示例：<br>&emsp;&emsp;主流程类Test.java：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.edu.whu.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> freemarker.template.Configuration;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.Template;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.TemplateExceptionHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStreamWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.Writer;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wawu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2017/9/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* ------------------------------------------------------------------------ */</span></span><br><span class="line">        <span class="comment">/* Step1：实例化Configuration类并设置其属性。</span></span><br><span class="line"><span class="comment">            注意：</span></span><br><span class="line"><span class="comment">            1. 整个应用周期中只需要实例化一次</span></span><br><span class="line"><span class="comment">            2. Configuration类对象是单例的</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        Configuration cfg = <span class="keyword">new</span> Configuration(Configuration.VERSION_2_3_25);</span><br><span class="line">        cfg.setDirectoryForTemplateLoading(<span class="keyword">new</span> File(<span class="string">"/Users/wuwenan/Development/IdeaProjects/FreemarkerTest/src/main/resources"</span>));</span><br><span class="line">        cfg.setDefaultEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">        cfg.setTemplateExceptionHandler(TemplateExceptionHandler.RETHROW_HANDLER);</span><br><span class="line">        cfg.setLogTemplateExceptions(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* ------------------------------------------------------------------------ */</span></span><br><span class="line">        <span class="comment">/* Step2：创建数据模型</span></span><br><span class="line"><span class="comment">            注意：</span></span><br><span class="line"><span class="comment">            1. 在应用的生命周期中，可能会需要创建多次，每一个模板需要对应一个数据模型</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        Map&lt;String, Object&gt; root = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        root.put(<span class="string">"user"</span>, <span class="string">"Big Joe"</span>);</span><br><span class="line">        Product latest = <span class="keyword">new</span> Product();</span><br><span class="line">        latest.setUrl(<span class="string">"products/greenmouse.html"</span>);</span><br><span class="line">        latest.setName(<span class="string">"green mouse"</span>);</span><br><span class="line">        root.put(<span class="string">"latestProduct"</span>, latest);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Step3：从文件获得模板，文件为test.ftl*/</span></span><br><span class="line">        Template temp = cfg.getTemplate(<span class="string">"test.ftl"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*Step4：将数据模型合并至模板中*/</span></span><br><span class="line">        Writer out = <span class="keyword">new</span> OutputStreamWriter(<span class="keyword">new</span> FileOutputStream(<span class="string">"/Users/wuwenan/Development/IdeaProjects/FreemarkerTest/src/main/resources/test.html"</span>));</span><br><span class="line">        temp.process(root, out);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*注意：根据out对象的不同，可能需要调用out.close()方法（通常输出为文件时需要调用），</span></span><br><span class="line"><span class="comment">            但在Web应用中不需要调用*/</span></span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;代码中用到的模板test.ftl：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome $&#123;user&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Our latest product:</span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;latestProduct.url&#125;"</span>&gt;</span>$&#123;latestProduct.name&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>!</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;代码中用到的实体类Product.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.edu.whu.test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wawu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2017/9/4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// As per the JavaBeans spec., this defines the "url" bean property</span></span><br><span class="line">    <span class="comment">// It must be public!</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUrl</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// As per the JavaBean spec., this defines the "name" bean property</span></span><br><span class="line">    <span class="comment">// It must be public!</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2017/09/04/FreeMarker模板引擎实战/#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-07-14 </div>
			<div class="article-title"><a href="/2017/07/14/Java——通配符和泛型边界/" title="Java泛型中有一个比较容易令人困惑的知识点：泛型的边界，而讨论泛型的边界则要涉及到通配符“？”的使用，本文将对此进行讲解。">Java——通配符和泛型边界</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<p>&emsp;&emsp;本文源起于笔者在阅读《Thinking in Java》泛型章节的时候，遇到的关于泛型边界的时候思考的一个问题，笔者就该问题分别询问了三位硕士小伙伴，大家都没有回答正确，因此笔者觉得有必要对此进行一个辨析。问题本身并不复杂，且听我细细道来。<br>&emsp;&emsp;首先，假设有四个类存在如下的继承关系：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fruit</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apple</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Jonathan</span> <span class="keyword">extends</span> <span class="title">Apple</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Orange</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>Fruit</code>类是超类，<code>Apple</code>和<code>Orange</code>继承了<code>Fruit</code>，而<code>Jonathan</code>继承了<code>Apple</code>。  </p>
<h1 id="泛型不存在协变"><a href="#泛型不存在协变" class="headerlink" title="泛型不存在协变"></a>泛型不存在协变</h1><p>&emsp;&emsp;首先我们来看这样一段代码：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> generics;<span class="comment">//: generics/NonCovariantGenerics.java</span></span><br><span class="line"><span class="comment">// &#123;CompileTimeError&#125; (Won't compile)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NonCovariantGenerics</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Compile Error: incompatible types:</span></span><br><span class="line">    List&lt;Fruit&gt; flist = <span class="keyword">new</span> ArrayList&lt;Apple&gt;();</span><br><span class="line">&#125; <span class="comment">///:~</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;从注释上可以看到，这段代码是无法通过编译的。你可能以为在第9行里，用<code>Apple</code>类型的ArrayList来初始化<code>Fruit</code>类型的List是向上转型，然而这并不是向上转型，<code>Apple</code>类型的List不是<code>Fruit</code>类型的List，因为<code>Apple</code>类型的List可以持有<code>Apple</code>对象及其子类对象，而<code>Fruit</code>类型的List将持有<code>Fruit</code>类型对象及其子类对象，包括<code>Apple</code>类型对象，它可持有的范围更大。<br>&emsp;&emsp;因此<strong>不能用<code>Apple</code>类型的List初始化<code>Fruit</code>类型的List</strong>，这说明<strong>泛型不存在协变类型</strong>。  </p>
<h1 id="通配符表示的泛型的下界"><a href="#通配符表示的泛型的下界" class="headerlink" title="通配符表示的泛型的下界"></a>通配符表示的泛型的下界</h1><p>&emsp;&emsp;但你还是想建立某种向上转型的关系，于是你想到了通配符：<code>？</code>，你可能会想到像下面这样来使用它：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> generics;<span class="comment">//: generics/GenericsAndCovariance.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericsAndCovariance</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Wildcards allow covariance:</span></span><br><span class="line">        List&lt;? extends Fruit&gt; flist = <span class="keyword">new</span> ArrayList&lt;Apple&gt;();</span><br><span class="line">        <span class="comment">// Compile Error: can't add any type of object:</span></span><br><span class="line">        <span class="comment">// flist.add(new Apple());</span></span><br><span class="line">        <span class="comment">// flist.add(new Fruit());</span></span><br><span class="line">        <span class="comment">// flist.add(new Object());</span></span><br><span class="line">        flist.add(<span class="keyword">null</span>); <span class="comment">// Legal but uninteresting</span></span><br><span class="line">        <span class="comment">// We know that it returns at least Fruit:</span></span><br><span class="line">        Fruit f = flist.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">///:~</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;很遗憾，从注释中你可以看到，像上面那样使用<code>extends</code>关键字，虽然可以通过编译，但在为List中添加对象的时候，是无法成功的，不论你添加的是<code>Fruit</code>本身，还是它的子类，甚至是<code>Object</code>，都无法添加成功。你唯一可以做的是从List中读取对象。<br>&emsp;&emsp;那么为什么不可以往该容器中装对象呢？因为<code>List&lt;? extends Fruit&gt;</code>表示该List持有的是<strong>“Fruit类的某个不确定的子类型”</strong>，但编译器并不知道该List中持有的究竟是<code>Fruit</code>的哪个子类型，因此无法将诸如<code>Apple</code>的<code>Fruit</code>的某个具体子类型装入该List，同时<code>Fruit</code>本身也不能被装入，当然，<code>Fruit</code>的父类型<code>Object</code>就更加不可以了，装入这些类时的转型都不是类型安全的。因此，这个通配符表示的泛型下界可以说是无下限的。<br>&emsp;&emsp;那么为什么可以调用<code>get()</code>方法来读取该List呢？我们已经知道该List中持有的一定是<code>Fruit</code>的某个子类型，因此它的上界是确定的，就是<code>Fruit</code>，因此当取出的时候，将它赋值给一个静态类型为<code>Fruit</code>的对象，就属于向上转型，因此是没有问题的。  </p>
<h1 id="通配符表示的泛型上界"><a href="#通配符表示的泛型上界" class="headerlink" title="通配符表示的泛型上界"></a>通配符表示的泛型上界</h1><p>&emsp;&emsp;通配符还有一种用法，就是表示泛型的上界，如下面所示：    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> generics;<span class="comment">//: generics/SuperTypeWildcards.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SuperTypeWildcards</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeTo</span><span class="params">(List&lt;? <span class="keyword">super</span> Apple&gt; apples)</span> </span>&#123;</span><br><span class="line">        apples.add(<span class="keyword">new</span> Apple());</span><br><span class="line">        apples.add(<span class="keyword">new</span> Jonathan());</span><br><span class="line">        <span class="comment">// apples.add(new Fruit()); // Error</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">///:~</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;像上面这样使用<code>List&lt;? super Apple&gt;</code>，就可以向List中添加<code>Apple</code>及其子类<code>Jonathan</code>了，但向其中添加<code>Apple</code>的父类<code>Fruit</code>则是不安全的。原因是<code>List&lt;? super Apple&gt;</code>表示该List持有的是<strong>Apple的某个不确定的超类型</strong>，既然该List中持有的一定是<code>Apple</code>的某个超类型，那么使用<code>add()</code>方法向其中添加<code>Apple</code>及其子类型，一定是类型安全的；但由于编译器只知道这个List持有的是<code>Apple</code>的某个超类型，但不能确定究竟是哪个超类型，因此向其中添加<code>Fruit</code>类型是不安全的。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>&emsp;&emsp;总结一下就是：  </p>
<ul>
<li><strong>&lt;? extends T&gt;</strong> 表示T的某个不确定的子类，因此不能存放具体的T类对象及其子类，更不能存放T的父类，因此<code>Object</code>类不能存放。</li>
<li><strong>&lt;? super T&gt;</strong> 表示T的某个不确定的超类，因此可以存放T类对象及T的子类对象。</li>
</ul>

	
	</div>
  <a type="button" href="/2017/07/14/Java——通配符和泛型边界/#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-06-25 </div>
			<div class="article-title"><a href="/2017/06/25/使用栈数据结构模拟递归时系统调用栈的行为/" title="本文通过利用栈数据结构将一个简单的递归方法改写为为使用循环的方法，模拟了系统调用栈在处理递归时的行为。">使用栈数据结构模拟递归时系统调用栈的行为</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<p>&emsp;&emsp;递归是经典的算法思想，递归的代码优美而简洁易懂。系统在处理递归时，使用系统调用栈来保存递归调用点的内存地址，以保证在返回时能够回到上一层方法的调用点继续执行。本文通过利用栈数据结构将一个简单的递归方法改写为为使用循环的方法，模拟了系统调用栈在处理递归时的行为。理解系统调用栈的行为，有助于我们对递归有更加深刻的理解。<br>&emsp;&emsp;下面给出递归方法的代码和改写后的代码：  </p>
<ul>
<li>递归方法：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> systemStack;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by wuwenan on 25/06/2017.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Recursion</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Foo</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> n*Foo(n-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(Foo(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这是一个简单的递归方法，其中递归的部分为<strong>f(n)=n*f(n-1)</strong>，下面将该方法改写为使用循环的方法。递归的调用分为两个阶段，第一阶段为<code>call</code>阶段，是从上层向下层一层层调用的阶段；第二阶段为<code>return</code>阶段，是从递归边界开始从下层想上层一层层返回的阶段。</p>
<ul>
<li>改写后的循环方法：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> systemStack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * java模拟递归调用的系统栈</span></span><br><span class="line"><span class="comment"> * Created by wuwenan on 25/06/2017.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemStack</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Foo</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="comment">//使用栈模拟系统栈的行为</span></span><br><span class="line">        Stack&lt;Integer&gt; systemStack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        <span class="comment">//back为true，表示递归调用的返回过程；back若为false，表示递归调用的调用过程</span></span><br><span class="line">        <span class="keyword">boolean</span> back = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">int</span> result=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!back)&#123;</span><br><span class="line">                <span class="comment">//调用过程</span></span><br><span class="line">                <span class="keyword">if</span>(n&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">                    back = <span class="keyword">true</span>;</span><br><span class="line">                    result = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                systemStack.push(n);</span><br><span class="line">                n--;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//返回过程</span></span><br><span class="line">                result*=systemStack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">while</span>(!systemStack.isEmpty());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(Foo(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上面的代码中使用了栈的数据结构模拟了系统调用栈的过程。这段代码有以下几个注意点：</p>
<ul>
<li>使用boolean类型变量<code>back</code>标识递归的调用和返回过程，若back值为true，表示当前的过程为return过程；若back值为false，表示当前过程为call过程。</li>
<li>在call过程中将每一层使用到的n值放入栈中</li>
<li>在return过程中将栈中的值一个个取出以和之前一次执行的结果相乘。</li>
<li><p>递归的边界是<strong>n&lt;=1</strong>。</p>
<p>&emsp;&emsp;两段代码输出的结果均为：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3628800</span></span><br></pre></td></tr></table></figure>
	
	</div>
  <a type="button" href="/2017/06/25/使用栈数据结构模拟递归时系统调用栈的行为/#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-06-16 </div>
			<div class="article-title"><a href="/2017/06/16/Java——Java虚拟机指令集/" title="JVM指令集列表的整理，以便将来review。">Java——Java虚拟机指令集</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<h1 id="JVM指令集"><a href="#JVM指令集" class="headerlink" title="JVM指令集"></a>JVM指令集</h1><p>0x00 nop      什么都不做<br>0x01 aconst_null 将null推送至操作栈栈顶<br>0x02 iconst_m1   将int型-1推送至操作栈栈顶<br>0x03 iconst_0   将int型0推送至操作栈栈顶<br>0x04 iconst_1   将int型1推送至操作栈栈顶<br>0x05 iconst_2   将int型2推送至操作栈栈顶<br>0x06 iconst_3   将int型3推送至操作栈栈顶<br>0x07 iconst_4   将int型4推送至操作栈栈顶<br>0x08 iconst_5   将int型5推送至操作栈栈顶<br>0x09 lconst_0   将long型0推送至操作栈栈顶<br>0x0a lconst_1   将long型1推送至操作栈栈顶<br>0x0b fconst_0   将float型0推送至操作栈栈顶<br>0x0c fconst_1   将float型1推送至操作栈栈顶<br>0x0d fconst_2   将float型2推送至操作栈栈顶<br>0x0e dconst_0   将double型0推送至操作栈栈顶<br>0x0f dconst_1   将double型1推送至操作栈栈顶<br>0x10 bipush    将单字节的常量值(-128~127)推送至操作栈栈顶<br>0x11 sipush    将一个短整型常量值(-32768~32767)推送至操作栈栈顶<br>0x12 ldc      将int, float或String型常量值从常量池中推送至操作栈栈顶<br>0x13 ldc_w     将int, float或String型常量值从常量池中推送至操作栈栈顶（宽索引）<br>0x14 ldc2_w    将long或double型常量值从常量池中推送至操作栈栈顶（宽索引）<br>0x15 iload     将指定的int型局部变量推送至操作栈栈顶<br>0x16 lload     将指定的long型局部变量推送至操作栈栈顶<br>0x17 fload     将指定的float型局部变量推送至操作栈栈顶<br>0x18 dload     将指定的double型局部变量推送至操作栈栈顶<br>0x19 aload     将指定的引用类型局部变量推送至操作栈栈顶<br>0x1a iload_0    将第一个int型局部变量推送至操作栈栈顶<br>0x1b iload_1    将第二个int型局部变量推送至操作栈栈顶<br>0x1c iload_2    将第三个int型局部变量推送至操作栈栈顶<br>0x1d iload_3    将第四个int型局部变量推送至操作栈栈顶<br>0x1e lload_0    将第一个long型局部变量推送至操作栈栈顶<br>0x1f lload_1    将第二个long型局部变量推送至操作栈栈顶<br>0x20 lload_2    将第三个long型局部变量推送至操作栈栈顶<br>0x21 lload_3    将第四个long型局部变量推送至操作栈栈顶<br>0x22 fload_0    将第一个float型局部变量推送至操作栈栈顶<br>0x23 fload_1    将第二个float型局部变量推送至操作栈栈顶<br>0x24 fload_2    将第三个float型局部变量推送至操作栈栈顶<br>0x25 fload_3    将第四个float型局部变量推送至操作栈栈顶<br>0x26 dload_0    将第一个double型局部变量推送至操作栈栈顶<br>0x27 dload_1    将第二个double型局部变量推送至操作栈栈顶<br>0x28 dload_2    将第三个double型局部变量推送至操作栈栈顶<br>0x29 dload_3    将第四个double型局部变量推送至操作栈栈顶<br>0x2a aload_0    将第一个引用类型局部变量推送至操作栈栈顶<br>0x2b aload_1    将第二个引用类型局部变量推送至操作栈栈顶<br>0x2c aload_2    将第三个引用类型局部变量推送至操作栈栈顶<br>0x2d aload_3    将第四个引用类型局部变量推送至操作栈栈顶<br>0x2e iaload    将int型数组指定索引的值推送至操作栈栈顶<br>0x2f laload    将long型数组指定索引的值推送至操作栈栈顶<br>0x30 faload    将float型数组指定索引的值推送至操作栈栈顶<br>0x31 daload    将double型数组指定索引的值推送至操作栈栈顶<br>0x32 aaload    将引用型数组指定索引的值推送至操作栈栈顶<br>0x33 baload    将boolean或byte型数组指定索引的值推送至操作栈栈顶<br>0x34 caload    将char型数组指定索引的值推送至操作栈栈顶<br>0x35 saload    将short型数组指定索引的值推送至操作栈栈顶<br>0x36 istore    将操作栈栈顶int型数值存入指定局部变量<br>0x37 lstore    将操作栈栈顶long型数值存入指定局部变量<br>0x38 fstore    将操作栈栈顶float型数值存入指定局部变量<br>0x39 dstore    将操作栈栈顶double型数值存入指定局部变量<br>0x3a astore    将操作栈栈顶引用型数值存入指定局部变量<br>0x3b istore_0   将操作栈栈顶int型数值存入第一个局部变量<br>0x3c istore_1   将操作栈栈顶int型数值存入第二个局部变量<br>0x3d istore_2   将操作栈栈顶int型数值存入第三个局部变量<br>0x3e istore_3   将操作栈栈顶int型数值存入第四个局部变量<br>0x3f lstore_0   将操作栈栈顶long型数值存入第一个局部变量<br>0x40 lstore_1   将操作栈栈顶long型数值存入第二个局部变量<br>0x41 lstore_2   将操作栈栈顶long型数值存入第三个局部变量<br>0x42 lstore_3   将操作栈栈顶long型数值存入第四个局部变量<br>0x43 fstore_0   将操作栈栈顶float型数值存入第一个局部变量<br>0x44 fstore_1   将操作栈栈顶float型数值存入第二个局部变量<br>0x45 fstore_2   将操作栈栈顶float型数值存入第三个局部变量<br>0x46 fstore_3   将操作栈栈顶float型数值存入第四个局部变量<br>0x47 dstore_0   将操作栈栈顶double型数值存入第一个局部变量<br>0x48 dstore_1   将操作栈栈顶double型数值存入第二个局部变量<br>0x49 dstore_2   将操作栈栈顶double型数值存入第三个局部变量<br>0x4a dstore_3   将操作栈栈顶double型数值存入第四个局部变量<br>0x4b astore_0   将操作栈栈顶引用型数值存入第一个局部变量<br>0x4c astore_1   将操作栈栈顶引用型数值存入第二个局部变量<br>0x4d astore_2   将操作栈栈顶引用型数值存入第三个局部变量<br>0x4e astore_3   将操作栈栈顶引用型数值存入第四个局部变量<br>0x4f iastore    将操作栈栈顶int型数值存入指定数组的指定索引位置<br>0x50 lastore    将操作栈栈顶long型数值存入指定数组的指定索引位置<br>0x51 fastore    将操作栈栈顶float型数值存入指定数组的指定索引位置<br>0x52 dastore    将操作栈栈顶double型数值存入指定数组的指定索引位置<br>0x53 aastore    将操作栈栈顶引用型数值存入指定数组的指定索引位置<br>0x54 bastore    将操作栈栈顶boolean或byte型数值存入指定数组的指定索引位置<br>0x55 castore    将操作栈栈顶char型数值存入指定数组的指定索引位置<br>0x56 sastore    将操作栈栈顶short型数值存入指定数组的指定索引位置<br>0x57 pop      将操作栈栈顶数值弹出 (数值不能是long或double类型的)<br>0x58 pop2     将操作栈栈顶的一个（long或double类型的)或两个数值弹出（其它）<br>0x59 dup      复制操作栈栈顶数值并将复制值压入操作栈栈顶<br>0x5a dup_x1    复制操作栈栈顶数值并将两个复制值压入操作栈栈顶<br>0x5b dup_x2    复制操作栈栈顶数值并将三个（或两个）复制值压入操作栈栈顶<br>0x5c dup2     复制操作栈栈顶一个（long或double类型的)或两个（其它）数值并将复制值压入操作栈栈顶<br>0x5d dup2_x1    &lt;待补充&gt;<br>0x5e dup2_x2    &lt;待补充&gt;<br>0x5f swap     将栈最顶端的两个数值互换(数值不能是long或double类型的)<br>0x60 iadd     将操作栈栈顶两int型数值相加并将结果压入操作栈栈顶<br>0x61 ladd     将操作栈栈顶两long型数值相加并将结果压入操作栈栈顶<br>0x62 fadd     将操作栈栈顶两float型数值相加并将结果压入操作栈栈顶<br>0x63 dadd     将操作栈栈顶两double型数值相加并将结果压入操作栈栈顶<br>0x64 is      将操作栈栈顶两int型数值相减并将结果压入操作栈栈顶<br>0x65 ls      将操作栈栈顶两long型数值相减并将结果压入操作栈栈顶<br>0x66 fs      将操作栈栈顶两float型数值相减并将结果压入操作栈栈顶<br>0x67 ds      将操作栈栈顶两double型数值相减并将结果压入操作栈栈顶<br>0x68 imul     将操作栈栈顶两int型数值相乘并将结果压入操作栈栈顶<br>0x69 lmul     将操作栈栈顶两long型数值相乘并将结果压入操作栈栈顶<br>0x6a fmul     将操作栈栈顶两float型数值相乘并将结果压入操作栈栈顶<br>0x6b dmul     将操作栈栈顶两double型数值相乘并将结果压入操作栈栈顶<br>0x6c idiv     将操作栈栈顶两int型数值相除并将结果压入操作栈栈顶<br>0x6d ldiv     将操作栈栈顶两long型数值相除并将结果压入操作栈栈顶<br>0x6e fdiv     将操作栈栈顶两float型数值相除并将结果压入操作栈栈顶<br>0x6f ddiv     将操作栈栈顶两double型数值相除并将结果压入操作栈栈顶<br>0x70 irem     将操作栈栈顶两int型数值作取模运算并将结果压入操作栈栈顶<br>0x71 lrem     将操作栈栈顶两long型数值作取模运算并将结果压入操作栈栈顶<br>0x72 frem     将操作栈栈顶两float型数值作取模运算并将结果压入操作栈栈顶<br>0x73 drem     将操作栈栈顶两double型数值作取模运算并将结果压入操作栈栈顶<br>0x74 ineg     将操作栈栈顶int型数值取负并将结果压入操作栈栈顶<br>0x75 lneg     将操作栈栈顶long型数值取负并将结果压入操作栈栈顶<br>0x76 fneg     将操作栈栈顶float型数值取负并将结果压入操作栈栈顶<br>0x77 dneg     将操作栈栈顶double型数值取负并将结果压入操作栈栈顶<br>0x78 ishl     将int型数值左移位指定位数并将结果压入操作栈栈顶<br>0x79 lshl     将long型数值左移位指定位数并将结果压入操作栈栈顶<br>0x7a ishr     将int型数值右（符号）移位指定位数并将结果压入操作栈栈顶<br>0x7b lshr     将long型数值右（符号）移位指定位数并将结果压入操作栈栈顶<br>0x7c iushr     将int型数值右（无符号）移位指定位数并将结果压入操作栈栈顶<br>0x7d lushr     将long型数值右（无符号）移位指定位数并将结果压入操作栈栈顶<br>0x7e iand     将操作栈栈顶两int型数值作“按位与”并将结果压入操作栈栈顶<br>0x7f land     将操作栈栈顶两long型数值作“按位与”并将结果压入操作栈栈顶<br>0x80 ior      将操作栈栈顶两int型数值作“按位或”并将结果压入操作栈栈顶<br>0x81 lor      将操作栈栈顶两long型数值作“按位或”并将结果压入操作栈栈顶<br>0x82 ixor     将操作栈栈顶两int型数值作“按位异或”并将结果压入操作栈栈顶<br>0x83 lxor     将操作栈栈顶两long型数值作“按位异或”并将结果压入操作栈栈顶<br>0x84 iinc     将指定int型变量增加指定值（i++, i–, i+=2）<br>0x85 i2l      将操作栈栈顶int型数值强制转换成long型数值并将结果压入操作栈栈顶<br>0x86 i2f      将操作栈栈顶int型数值强制转换成float型数值并将结果压入操作栈栈顶<br>0x87 i2d      将操作栈栈顶int型数值强制转换成double型数值并将结果压入操作栈栈顶<br>0x88 l2i      将操作栈栈顶long型数值强制转换成int型数值并将结果压入操作栈栈顶<br>0x89 l2f      将操作栈栈顶long型数值强制转换成float型数值并将结果压入操作栈栈顶<br>0x8a l2d      将操作栈栈顶long型数值强制转换成double型数值并将结果压入操作栈栈顶<br>0x8b f2i      将操作栈栈顶float型数值强制转换成int型数值并将结果压入操作栈栈顶<br>0x8c f2l      将操作栈栈顶float型数值强制转换成long型数值并将结果压入操作栈栈顶<br>0x8d f2d      将操作栈栈顶float型数值强制转换成double型数值并将结果压入操作栈栈顶<br>0x8e d2i      将操作栈栈顶double型数值强制转换成int型数值并将结果压入操作栈栈顶<br>0x8f d2l      将操作栈栈顶double型数值强制转换成long型数值并将结果压入操作栈栈顶<br>0x90 d2f      将操作栈栈顶double型数值强制转换成float型数值并将结果压入操作栈栈顶<br>0x91 i2b      将操作栈栈顶int型数值强制转换成byte型数值并将结果压入操作栈栈顶<br>0x92 i2c      将操作栈栈顶int型数值强制转换成char型数值并将结果压入操作栈栈顶<br>0x93 i2s      将操作栈栈顶int型数值强制转换成short型数值并将结果压入操作栈栈顶<br>0x94 lcmp     比较操作栈栈顶两long型数值大小，并将结果（1，0，-1）压入操作栈栈顶<br>0x95 fcmpl     比较操作栈栈顶两float型数值大小，并将结果（1，0，-1）压入操作栈栈顶；当其中一个数值为NaN时，将-1压入操作栈栈顶<br>0x96 fcmpg     比较操作栈栈顶两float型数值大小，并将结果（1，0，-1）压入操作栈栈顶；当其中一个数值为NaN时，将1压入操作栈栈顶<br>0x97 dcmpl     比较操作栈栈顶两double型数值大小，并将结果（1，0，-1）压入操作栈栈顶；当其中一个数值为NaN时，将-1压入操作栈栈顶<br>0x98 dcmpg     比较操作栈栈顶两double型数值大小，并将结果（1，0，-1）压入操作栈栈顶；当其中一个数值为NaN时，将1压入操作栈栈顶<br>0x99 ifeq     当操作栈栈顶int型数值等于0时跳转<br>0x9a ifne     当操作栈栈顶int型数值不等于0时跳转<br>0x9b iflt     当操作栈栈顶int型数值小于0时跳转<br>0x9c ifge     当操作栈栈顶int型数值大于等于0时跳转<br>0x9d ifgt     当操作栈栈顶int型数值大于0时跳转<br>0x9e ifle     当操作栈栈顶int型数值小于等于0时跳转<br>0x9f if_icmpeq   比较操作栈栈顶两int型数值大小，当结果等于0时跳转<br>0xa0 if_icmpne   比较操作栈栈顶两int型数值大小，当结果不等于0时跳转<br>0xa1 if_icmplt   比较操作栈栈顶两int型数值大小，当结果小于0时跳转<br>0xa2 if_icmpge   比较操作栈栈顶两int型数值大小，当结果大于等于0时跳转<br>0xa3 if_icmpgt   比较操作栈栈顶两int型数值大小，当结果大于0时跳转<br>0xa4 if_icmple   比较操作栈栈顶两int型数值大小，当结果小于等于0时跳转<br>0xa5 if_acmpeq   比较操作栈栈顶两引用型数值，当结果相等时跳转<br>0xa6 if_acmpne   比较操作栈栈顶两引用型数值，当结果不相等时跳转<br>0xa7 goto     无条件跳转<br>0xa8 jsr      跳转至指定16位offset位置，并将jsr下一条指令地址压入操作栈栈顶<br>0xa9 ret      返回至局部变量指定的index的指令位置（一般与jsr, jsr_w联合使用）<br>0xaa tableswitch    用于switch条件跳转，case值连续（可变长度指令）<br>0xab lookupswitch   用于switch条件跳转，case值不连续（可变长度指令）<br>0xac ireturn    从当前方法返回int<br>0xad lreturn    从当前方法返回long<br>0xae freturn    从当前方法返回float<br>0xaf dreturn    从当前方法返回double<br>0xb0 areturn    从当前方法返回对象引用<br>0xb1 return    从当前方法返回void<br>0xb2 getstatic   获取指定类的静态域，并将其值压入操作栈栈顶<br>0xb3 putstatic   为指定的类的静态域赋值<br>0xb4 getfield   获取指定类的实例域，并将其值压入操作栈栈顶<br>0xb5 putfield   为指定的类的实例域赋值<br>0xb6 invokevirt l   调用实例方法<br>0xb7 invokespecial   调用实例构造器<init>方法，私有方法和父类方法<br>0xb8 invokestatic   调用静态方法<br>0xb9 invokeinterface 调用接口方法<br>0xba –<br>0xbb new      创建一个对象，并将其引用值压入操作栈栈顶<br>0xbc newarray   创建一个指定原始类型（如int, float, char…）的数组，并将其引用值压入操作栈栈顶<br>0xbd anewarray   创建一个引用型（如类，接口，数组）的数组，并将其引用值压入操作栈栈顶<br>0xbe arraylength 获得数组的长度值并压入操作栈栈顶<br>0xbf athrow    将操作栈栈顶的异常抛出<br>0xc0 checkcast   检验类型转换，检验未通过将抛出ClassCastException<br>0xc1 instanceof 检验对象是否是指定的类的实例，如果是将1压入操作栈栈顶，否则将0压入操作栈栈顶<br>0xc2 monitorenter   获得对象的锁，用于同步方法或同步块<br>0xc3 monitorexit    释放对象的锁，用于同步方法或同步块<br>0xc4 wide     &lt;待补充&gt;<br>0xc5 multianewarray   创建指定类型和指定维度的多维数组（执行该指令时，操作栈中必须包含各维度的长度值），并将其引用值压入操作栈栈顶<br>0xc6 ifnull    为null时跳转<br>0xc7 ifnonnull   不为null时跳转<br>0xc8 goto_w    无条件跳转（宽索引）<br>0xc9 jsr_w     跳转至指定32位offset位置，并将jsr_w下一条指令地址压入操作栈栈顶  </init></p>
<h1 id="JVM指令助记符"><a href="#JVM指令助记符" class="headerlink" title="JVM指令助记符"></a>JVM指令助记符</h1><p>局部变量到操作栈：iload,iload_,lload,lload_,fload,fload_,dload,dload_,aload,aload_<br>操作栈到局部变量：istore,istore_,lstore,lstore_,fstore,fstore_,dstore,dstor_,astore,astore_<br>常数到操作栈：bipush,sipush,ldc,ldc_w,ldc2_w,aconst_null,iconst_ml,iconst_,lconst_,fconst_,dconst_<br>加：iadd,ladd,fadd,dadd<br>减：is ,ls ,fs ,ds<br>乘：imul,lmul,fmul,dmul<br>除：idiv,ldiv,fdiv,ddiv<br>余数：irem,lrem,frem,drem<br>取负：ineg,lneg,fneg,dneg<br>移位：ishl,lshr,iushr,lshl,lshr,lushr<br>按位或：ior,lor<br>按位与：iand,land<br>按位异或：ixor,lxor<br>类型转换：i2l,i2f,i2d,l2f,l2d,f2d(放宽数值转换)<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;i2b,i2c,i2s,l2i,f2i,f2l,d2i,d2l,d2f(缩窄数值转换)<br>创建类实例：new<br>创建新数组：newarray,anewarray,multianwarray<br>访问类的域和类实例域：getfield,putfield,getstatic,putstatic<br>把数据装载到操作栈：baload,caload,saload,iaload,laload,faload,daload,aaload<br>从操作栈存存储到数组：bastore,castore,sastore,iastore,lastore,fastore,dastore,aastore<br>获取数组长度：arraylength<br>检相类实例或数组属性：instanceof,checkcast<br>操作栈管理：pop,pop2,dup,dup2,dup_xl,dup2_xl,dup_x2,dup2_x2,swap<br>有条件转移：ifeq,iflt,ifle,ifne,ifgt,ifge,ifnull,ifnonnull,if_icmpeq,if_icmpene,if_icmplt,if_icmpgt,if_icmple,if_icmpge,<br>if_acmpeq,if_acmpne,lcmp,fcmpl,fcmpg,dcmpl,dcmpg<br>复合条件转移：tableswitch,lookupswitch<br>无条件转移：goto,goto_w,jsr,jsr_w,ret<br>调度对象的实便方法：invokevirt l<br>调用由接口实现的方法：invokeinterface<br>调用需要特殊处理的实例方法：invokespecial<br>调用命名类中的静态方法：invokestatic<br>方法返回：ireturn,lreturn,freturn,dreturn,areturn,return<br>异常：athrow<br>finally关键字的实现使用：jsr,jsr_w,ret  </p>

	
	</div>
  <a type="button" href="/2017/06/16/Java——Java虚拟机指令集/#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-06-10 </div>
			<div class="article-title"><a href="/2017/06/10/Java——虚拟机运行时数据区/" title="Java虚拟机在执行Java程序的过程中会将其管理的内存分为多个不同的区域，了解这些区域，有助于编码时规避一些内存管理的错误。本文为笔者对于它的一些归纳，以便于今后的复习查找。">Java——虚拟机运行时数据区</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<p>&emsp;&emsp;Java虚拟机在执行Java程序的过程中会将其管理的内存分为多个不同的区域，了解这些区域，有助于编码时规避和排查一些内存管理的错误。  </p>
<h2 id="Java运行时数据区域划分"><a href="#Java运行时数据区域划分" class="headerlink" title="Java运行时数据区域划分"></a>Java运行时数据区域划分</h2><p>&emsp;&emsp;在《Java虚拟机规范》中，对于运行时数据区域有以下划分，但在具体的不同虚拟机的实现中，可能有所不同，本文将整理最基本的划分情况，同时会涉及到目前应用最广泛的虚拟机——HotSpot虚拟机中的使用情况。<br>&emsp;&emsp;首先给出Java虚拟机运行时数据区的划分情况图：  </p>
<p align="center"><br><img src="http://odnk9as2f.bkt.clouddn.com/Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.png" width="600px" alt="Java虚拟机运行时数据区"><br></p>

<p>&emsp;&emsp;如上图所示，虚拟机将运行时数据区分为五块，其中由所有线程共享的区域有：方法区、堆；线程隔离的数据区有：虚拟机栈、本地方法栈、程序计数器。在HotSpot虚拟机中，将虚拟机栈和本地方法栈合二为一，因此HotSpot虚拟机的运行时数据区共有四块。以下分别介绍各个区域的概况。</p>
<h2 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h2><p>&emsp;&emsp;程序计数器为线程私有，该区域是一块较小的内存空间，指示了当前线程所执行的字节码行号。若正在执行Java方法，则该计数器执行的是正在执行的虚拟机字节码指令地址；若正在执行Native方法，则该计数器为空（Undifined）。</p>
<h2 id="Java虚拟机栈和本地方法栈"><a href="#Java虚拟机栈和本地方法栈" class="headerlink" title="Java虚拟机栈和本地方法栈"></a>Java虚拟机栈和本地方法栈</h2><h3 id="Java虚拟机栈"><a href="#Java虚拟机栈" class="headerlink" title="Java虚拟机栈"></a>Java虚拟机栈</h3><p>&emsp;&emsp;Java虚拟机栈为线程私有，其生命周期与线程相同。它存储了一个个栈帧(Stack Frame)，每个方法在执行时都会创建一栈帧，栈帧中存储了：<strong>局部变量表、操作数栈、动态链接、方法出口（即返回地址）</strong>等信息。<br>&emsp;&emsp;人们常说的<code>栈内存(Stack)</code>，严格来说就是指的虚拟机栈栈帧中的<code>局部变量表</code>部分，在上图中已用红色方框进行了标注。局部变量表存储了编译期可知的各种<strong>基本数据类型（boolean、byte、char、short、int、float、long、dobule）、对象引用（reference类型）和returnAddress类型</strong>的数据。<br>&emsp;&emsp;在局部变量表中存储数据的单位是<strong>变量槽（Variable Slot，简称Slot）</strong>，其中64位长度的<strong>long</strong>和<strong>double</strong>类型的数据占用2个Slot，其它类型的数据占据1个Slot。局部变量表所需的内存在编译期间完成分配，运行期间不会改变它的大小。</p>
<h3 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h3><p>&emsp;&emsp;本地方法栈与Java虚拟机栈作用相似，区别在于Java虚拟机栈为执行Java方法（即字节码）服务，而本地方法栈为执行Native方法服务。那么什么是Native方法呢？简单来说，一个Native方法就是一个Java调用非Java代码的接口，Native方法一般由非Java语言实现，如C或者C++。<br>&emsp;&emsp;<strong>在HotSpot虚拟机中，本地方法栈和虚拟机栈是合二为一的</strong>，在上图中笔者用蓝色方框进行了标注。</p>
<h2 id="Java堆"><a href="#Java堆" class="headerlink" title="Java堆"></a>Java堆</h2><p>&emsp;&emsp;Java堆就是人们常说的<code>堆内存(Heap)</code>，该内存是线程共享的，其生命周期与虚拟机的启动和关闭相同。<strong>该内存的唯一目的就是存放对象实例</strong>，它是垃圾收集器管理的主要区域。<br>&emsp;&emsp;在HotSpot虚拟机中，从内存回收的角度来看，Java堆又分为<code>新生代（Young Generation）</code>和<code>老年代（Tenured Generation）</code>，回收新生代的算法为<strong>复制算法</strong>，再该算法中，又将新生代分为一块较大的<code>Eden空间</code>和两块较小的<code>From Suvivor空间</code>和<code>To Survivor空间</code>；回收老年代的算法为<strong>标记-整理算法</strong>或<strong>标记-清除算法</strong>。</p>
<h2 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h2><p>&emsp;&emsp;方法区是线程共享的，它存储了<code>类数据</code>，包括：<strong>类信息、常量、静态变量、即时编译器编译后的代码</strong>等数据。方法区有一个别名叫<code>非堆(Non-Heap)</code>，在上图中已经用红色的字标注。<br>&amp;emsp&emsp;在HotSpot虚拟机中，方法区被称为<code>永久代（Permanent Generation）</code>，HotSpot虚拟机的垃圾收集器像管理Java堆一样管理这部分内存，该区域的内存回收行为较少出现，该区域内存回收的主要目标是<strong>针对常量池的回收</strong>和<strong>对类型的卸载</strong>。  </p>
<h3 id="运行时常量池"><a href="#运行时常量池" class="headerlink" title="运行时常量池"></a>运行时常量池</h3><p>&emsp;&emsp;方法区中有一个部分叫做<code>运行时常量池(Runtime Constant Pool)</code>，该区域保存的就是编译器生成的各种<strong>字面量、符号引用和直接引用</strong>。</p>

	
	</div>
  <a type="button" href="/2017/06/10/Java——虚拟机运行时数据区/#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-05-12 </div>
			<div class="article-title"><a href="/2017/05/12/JavaWeb——Servlet异步处理支持和异步监听器/" title="Servlet的异步支持是Servlet3.0中的新特性，它允许Servlet开启一个新的线程来异步处理业务，本文通过一个示例来介绍该特性。">JavaWeb——Servlet异步处理支持和异步监听器</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<p>&emsp;&emsp;Servlet的异步支持是Servlet3.0中的新特性，它允许Servlet开启一个新的线程来异步处理业务，本文通过一个示例来介绍该特性。</p>
<h2 id="Servlet异步处理支持"><a href="#Servlet异步处理支持" class="headerlink" title="Servlet异步处理支持"></a>Servlet异步处理支持</h2><p>&emsp;&emsp;Servlet3.0中加入了线程的异步支持，在增加异步支持以前，Servlet的工作流程大致如下：  </p>
<ol>
<li>接收请求，对请求进行一些预处理。  </li>
<li>调用业务逻辑接口进行完成业务的处理。  </li>
<li>根据处理结果提交响应。  </li>
</ol>
<p>&emsp;&emsp;通常在第二步会消耗大量处理时间，因为Servlet线程会等待业务方法处理完毕。<br>&emsp;&emsp;在Servlet3.0中增加了异步支持之后，允许Servlet创建新的线程执行业务逻辑，使得Servlet在启动异步线程后自身可以立即返回容器。</p>
<h2 id="异步监听器"><a href="#异步监听器" class="headerlink" title="异步监听器"></a>异步监听器</h2><p>&emsp;&emsp;Servlet3.0同时增加了异步监听器，该监听器实现AsyncListener接口，该监听器提供了四个方法：  </p>
<ol>
<li>onStartAsync(AsyncEvent event) 异步线程开始时调用；  </li>
<li>onError(AsyncEvent event) 异步线程出错时调用</li>
<li>onTimeout(AsyncEvent event) 异步线程执行超时时调用  </li>
<li>onComplete(AsyncEvent event) 异步线程执行完毕时调用  </li>
</ol>
<h2 id="异步Servlet和异步监听器使用步骤"><a href="#异步Servlet和异步监听器使用步骤" class="headerlink" title="异步Servlet和异步监听器使用步骤"></a>异步Servlet和异步监听器使用步骤</h2><p>&emsp;&emsp;具体的异步Servlet和监听器使用共分为三步：  </p>
<ol>
<li>获得异步上下文  </li>
<li>注册监听器</li>
<li>开启异步子线程，子线程执行业务方法  </li>
</ol>
<p>&emsp;&emsp;下面用一个示例来展示二者的使用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">contentType</span>=<span class="string">"text/html;charset=UTF-8"</span> <span class="attr">language</span>=<span class="string">"java"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>异步Servlet和Listener示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/AsyncServlet"</span>&gt;</span>访问异步Servlet<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.AsyncContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.AsyncEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.AsyncListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by wuwenan on 12/05/2017.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet</span>(name = <span class="string">"AsyncServlet"</span>,</span><br><span class="line">        urlPatterns = <span class="string">"/AsyncServlet"</span>,</span><br><span class="line">        <span class="comment">//开启异步支持</span></span><br><span class="line">        asyncSupported = <span class="keyword">true</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Servlet开始时间："</span> + <span class="keyword">new</span> SimpleDateFormat(<span class="string">"YYYY-MM-dd HH:mm:ss"</span>).format(<span class="keyword">new</span> Date()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//step1:获得异步上下文</span></span><br><span class="line">        AsyncContext ctx = request.startAsync();</span><br><span class="line">        <span class="comment">//step2:注册监听器</span></span><br><span class="line">        ctx.addListener(<span class="keyword">new</span> AsyncListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">(AsyncEvent asyncEvent)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"onComplete..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimeout</span><span class="params">(AsyncEvent asyncEvent)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"onTimeout..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(AsyncEvent asyncEvent)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"onError..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartAsync</span><span class="params">(AsyncEvent asyncEvent)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"onStartAsync..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//step3:开启异步子线程，子线程执行业务方法</span></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Executor(ctx)).start();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Servlet结束时间："</span> + <span class="keyword">new</span> SimpleDateFormat(<span class="string">"YYYY-MM-dd HH:mm:ss"</span>).format(<span class="keyword">new</span> Date()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//子线程类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Executor</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> AsyncContext ctx;</span><br><span class="line"></span><br><span class="line">        Executor(AsyncContext ctx) &#123;</span><br><span class="line">            <span class="keyword">this</span>.ctx = ctx;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"业务开始时间："</span>+<span class="keyword">new</span> SimpleDateFormat(<span class="string">"YYYY-MM-dd HH:mm:ss"</span>).format(<span class="keyword">new</span> Date()));</span><br><span class="line"></span><br><span class="line">                <span class="comment">//线程等待十秒钟，以模拟业务方法执行</span></span><br><span class="line">                Thread.sleep(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">"业务结束时间："</span>+<span class="keyword">new</span> SimpleDateFormat(<span class="string">"YYYY-MM-dd HH:mm:ss"</span>).format(<span class="keyword">new</span> Date()));</span><br><span class="line"></span><br><span class="line">                <span class="comment">//关闭异步上下文</span></span><br><span class="line">                ctx.complete();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;执行结果如下所示：  </p>
<p>Servlet开始时间：2017-05-12 11:49:54<br>Servlet结束时间：2017-05-12 11:49:54<br>业务开始时间：2017-05-12 11:49:54<br>业务结束时间：2017-05-12 11:50:04<br>onComplete…</p>

	
	</div>
  <a type="button" href="/2017/05/12/JavaWeb——Servlet异步处理支持和异步监听器/#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-05-09 </div>
			<div class="article-title"><a href="/2017/05/09/Java——对象的序列化与反序列化（2）/" title="本文是Java对象的序列化与反序列化的第二篇，主要记录了自定义序列化与反序列化的方式，以及序列化与反序列化过程中继承的关系。">Java——对象的序列化与反序列化（2）</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<p>&emsp;&emsp;序列化与反序列化操作中，可能在某些情况下我们不希望对象中的所有元素都被序列化，如对象中的某个元素是密码一类的敏感信息，若经过序列化处理，可能被他人通过读取文件或拦截网络传输等方式访问到。防止自定义序列化的方式有两种：<br>&emsp;&emsp;第一种是将类实现Externalizable接口，该接口继承了Serializable接口同时增添了两个方法：writeExternal()和readExternal()<br>&emsp;&emsp;第二种是在实现Serializable接口时使用transient（瞬时）关键字。<br>&emsp;&emsp;本文继承上文，介绍上面的第二种方法。</p>
<h2 id="Serizable类对象自定义序列化"><a href="#Serizable类对象自定义序列化" class="headerlink" title="Serizable类对象自定义序列化"></a>Serizable类对象自定义序列化</h2><p>&emsp;&emsp;自定义序列化有两个关键点，如下：<br>&emsp;&emsp;&emsp;&emsp;1. 使用transient（瞬时）关键字，当使用该关键字时，可通过它逐个字段地关闭序列化。<br>&emsp;&emsp;&emsp;&emsp;2. 重写writeObject()和readObject()方法。<br>具体代码示例如下：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义序列化和反序列化操作</span></span><br><span class="line"><span class="comment"> * Created by wuwenan on 09/05/2017.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Student&#123;"</span> +</span><br><span class="line">                <span class="string">"id='"</span> + id + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> java.io.IOException</span>&#123;</span><br><span class="line">        <span class="comment">//把jvm能默认序列化的元素进行序列化操作</span></span><br><span class="line">        s.defaultWriteObject();</span><br><span class="line">        <span class="comment">//自定义序列化</span></span><br><span class="line">        s.writeObject(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        <span class="comment">//把jvm能默认反序列化的元素进行反序列化操作</span></span><br><span class="line">        s.defaultReadObject();</span><br><span class="line">        <span class="comment">//自己完成反序列化操作</span></span><br><span class="line">        <span class="keyword">this</span>.name = (String) s.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.对象序列化</span></span><br><span class="line">        <span class="comment">//创建对象实例</span></span><br><span class="line">        Student student = <span class="keyword">new</span> Student(<span class="string">"123"</span>,<span class="string">"娜美"</span>);</span><br><span class="line">        <span class="comment">//创建文件</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">"/Users/wuwenan/Work/customSerialization.txt"</span>);</span><br><span class="line">        <span class="keyword">if</span>(!file.exists())&#123;</span><br><span class="line">            file.createNewFile();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//从文件创建序列化流对象</span></span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(file));</span><br><span class="line">        <span class="comment">//将对象实例写入序列化流缓存</span></span><br><span class="line">        oos.writeObject(student);</span><br><span class="line">        <span class="comment">//将序列化流缓存输出</span></span><br><span class="line">        oos.flush();</span><br><span class="line">        <span class="comment">//关闭序列化流</span></span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.对象的反序列化</span></span><br><span class="line">        <span class="comment">//从文件创建反序列化流对象</span></span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(file));</span><br><span class="line">        <span class="comment">//通过反序列化流对象读取实体对象，由于返回的是Object类型，因此要进行向下转型</span></span><br><span class="line">        Student stu1 = (Student) ois.readObject();</span><br><span class="line">        System.out.println(stu1);</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="序列化和反序列化中的继承问题"><a href="#序列化和反序列化中的继承问题" class="headerlink" title="序列化和反序列化中的继承问题"></a>序列化和反序列化中的继承问题</h2><p>&emsp;&emsp;一个类实现了序列化接口，那么其子类都可以进行序列化；在对子类对象进行反序列化时，若其父类没有实现序列化接口，则从没有实现序列化接口的那一级父类开始，该类及其所有子类的构造方法会被显式调用。<br>&emsp;&emsp;以下分别用两个demo来说明：<br>&emsp;&emsp;一个类实现了序列化接口，那么其子类都可以进行序列化。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by wuwenan on 2016/12/5 0005.</span></span><br><span class="line"><span class="comment"> * 对象序列化示例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectSeriaDemo2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">"/Users/wuwenan/Work/serialization2.txt"</span>);</span><br><span class="line">        <span class="keyword">if</span>(!file.exists())&#123;</span><br><span class="line">            file.createNewFile();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//1.进行序列化</span></span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(</span><br><span class="line">                <span class="keyword">new</span> FileOutputStream(file));</span><br><span class="line">        Foo2 foo2 = <span class="keyword">new</span> Foo2();</span><br><span class="line">        oos.writeObject(foo2);</span><br><span class="line">        oos.flush();</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.进行反序列化</span></span><br><span class="line">        <span class="comment">//反序列化是否递归调用父类构造函数，这里控制台只打印了对象，但不能说明没有调用父类构造函数</span></span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(</span><br><span class="line">                <span class="keyword">new</span> FileInputStream(file));</span><br><span class="line">        Foo2 foo2temp = (Foo2) ois.readObject();</span><br><span class="line">        System.out.println(foo2temp);</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">一个类实现了序列化接口，那么其子类都可以进行序列化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Foo..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo1</span> <span class="keyword">extends</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Foo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Foo1..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo2</span> <span class="keyword">extends</span> <span class="title">Foo1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Foo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Foo2..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在对子类对象进行反序列化时，若其父类没有实现序列化接口，则从没有实现序列化接口的那一级父类开始，该类及其所有子类的构造方法会被显式调用。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by wuwenan on 2016/12/5 0005.</span></span><br><span class="line"><span class="comment"> * 对象序列化示例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectSeriaDemo2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        <span class="comment">//创建序列化测试文件</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">"/Users/wuwenan/Work/serializationBar.txt"</span>);</span><br><span class="line">        <span class="keyword">if</span>(!file.exists())&#123;</span><br><span class="line">            file.createNewFile();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//进行序列化</span></span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(</span><br><span class="line">                <span class="keyword">new</span> FileOutputStream(<span class="string">"/Users/wuwenan/Work/serializationBar.txt"</span>));</span><br><span class="line">        Bar2 bar2 = <span class="keyword">new</span> Bar2();</span><br><span class="line">        oos.writeObject(bar2);</span><br><span class="line">        oos.flush();</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//进行反序列化</span></span><br><span class="line">        System.out.println(<span class="string">"====反序列化的分隔线===="</span>);</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(</span><br><span class="line">                <span class="keyword">new</span> FileInputStream(<span class="string">"/Users/wuwenan/Work/serializationBar.txt"</span>));</span><br><span class="line">        Bar2 bar2temp = (Bar2) ois.readObject();</span><br><span class="line">        System.out.println(bar2temp);</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Bar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"bar"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar1</span> <span class="keyword">extends</span> <span class="title">Bar</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Bar1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"bar1..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar2</span> <span class="keyword">extends</span> <span class="title">Bar1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Bar2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"bar2..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2017/05/09/Java——对象的序列化与反序列化（2）/#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-05-05 </div>
			<div class="article-title"><a href="/2017/05/05/Java——对象的序列化与反序列化（1）/" title="关于序列化和反序列化将要写两篇博客，第一篇介绍基本序列化与反序列化方法，第二篇将介绍如何自己实现元素的序列化与反序列化问题。">Java——对象的序列化与反序列化（1）</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<p>&emsp;&emsp;关于序列化和反序列化将要写两篇博客，第一篇介绍基本序列化与反序列化方法，第二篇将介绍如何自己实现元素的序列化与反序列化问题。  </p>
	
	</div>
  <a type="button" href="/2017/05/05/Java——对象的序列化与反序列化（1）/#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-05-04 </div>
			<div class="article-title"><a href="/2017/05/04/Java——JDBC执行SQL语句的两种方式/" title="本文记录一下JDBC执行SQL语句的两种方式，分别是使用Statment对象和使用PreparedStatment对象。">Java——JDBC执行SQL语句的两种方式</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<p>&emsp;&emsp;本文记录一下JDBC执行SQL语句的两种方式，分别是使用Statment对象和使用PreparedStatment对象。  </p>
	
	</div>
  <a type="button" href="/2017/05/04/Java——JDBC执行SQL语句的两种方式/#more" class="btn btn-default more">阅读此文</a>
</div>

	       
		     
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-04-30 </div>
			<div class="article-title"><a href="/2017/04/30/Java——利用Collections.sort()对List排序/" title="本文利用Collections.sort()对泛型为String的List排序">Java——利用Collections.sort()对泛型为String的List排序</a></div>						
		</h3>
	


		     <div class="entry">
  <div class="row">
	
	
		<p>&emsp;&emsp;本文利用Collections.sort()对泛型为String的List排序  </p>
<p>练习：利用Collections.sort()方法对泛型为String的List进行排序，要求：  </p>
<ol>
<li>创建完List<string>之后，往其中添加十条随机字符串  </string></li>
<li>每条字符串的长度为10以内的随机整数  </li>
<li>每条字符串的每个字符都为随机生成的字符，字符可以重复  </li>
<li>每条随机字符串不可重复  </li>
</ol>
<p>&emsp;&emsp;以下是实现代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Wenan Wu on 2016/11/16 0016.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise6_5</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 练习：利用Collections.sort()方法对泛型为String的List进行排序：</span></span><br><span class="line"><span class="comment">     * 1.创建完list&lt;String&gt;之后，往其中添加十条随机字符串</span></span><br><span class="line"><span class="comment">     * 2.每条字符串的长度为10以内的随机整数</span></span><br><span class="line"><span class="comment">     * 3.每条字符串的每个字符都为随机生成的字符，字符可以重复</span></span><br><span class="line"><span class="comment">     * 4.每条随机字符串不可重复</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成长度为10以内整数的字符串方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRandomString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String base = <span class="string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span>;</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">int</span> length; <span class="comment">// 字符串长度值</span></span><br><span class="line">        <span class="keyword">do</span> &#123; <span class="comment">//确保字符串长度不为0</span></span><br><span class="line">            length = random.nextInt(<span class="number">10</span>);</span><br><span class="line">        &#125; <span class="keyword">while</span> (length==<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> number = random.nextInt(base.length());</span><br><span class="line">            sb.append(base.charAt(number));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试字符串排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Exercise6_5 ex1 = <span class="keyword">new</span> Exercise6_5();</span><br><span class="line">        List&lt;String&gt; stringList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        String string;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;<span class="comment">//确保List中没有重复字符串</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                string = ex1.getRandomString();</span><br><span class="line">            &#125;<span class="keyword">while</span> (stringList.contains(string));</span><br><span class="line">            stringList.add(string);</span><br><span class="line">            System.out.println(<span class="string">"增加的字符串为："</span> + string);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"------------排序前----------"</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s :</span><br><span class="line">                stringList) &#123;</span><br><span class="line">            System.out.println(<span class="string">"元素："</span> + s);</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.sort(stringList);</span><br><span class="line">        System.out.println(<span class="string">"---------排序后---------"</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s :</span><br><span class="line">                stringList) &#123;</span><br><span class="line">            System.out.println(<span class="string">"元素："</span> + s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Exercise6_5 ex = <span class="keyword">new</span> Exercise6_5();</span><br><span class="line">        ex.testSort();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2017/04/30/Java——利用Collections.sort()对List排序/#more" class="btn btn-default more">阅读此文</a>
</div>

	       
	     </div>
	     <div>
	       <center>
	         <div class="pagination">
<ul class="pagination">
	 
		
          <li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>上一页</a></li>
        

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/tags/Java/page/2/" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

	       </center>
	     </div>	
      

</div> <!-- col-md-9/col-md-12 -->


<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			<div class="widget">
    
	    <h4 class="dsq-widget-title">最新留言</h4>
		<div id="recent-comments"></div>
		<script type="text/javascript">
		    getRecentCommentsList({
			   type: "github" ? "github" : "github",
			   user: "wzpan",
               repo: "hexo-theme-freemind-blog",
               client_id: "bf7d4ba11877db88543e",
               client_secret: "bff8a6b06b745c0bfcdccbe225623ea8e2a057bb",
			   count: "5" ? "5" : 5,
			   recent_comments_target: "#recent-comments"
			});
		</script>
	
</div>

		
			
	<div class="widget">
		<h4>分类</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/Python/Docker/">Docker<span>1</span></a></li>
		
			<li><a href="/categories/Java/">Java<span>9</span></a></li>
		
			<li><a href="/categories/Linux/">Linux<span>1</span></a></li>
		
			<li><a href="/categories/Python/">Python<span>1</span></a></li>
		
			<li><a href="/categories/Web开发/">Web开发<span>1</span></a></li>
		
			<li><a href="/categories/图像处理/">图像处理<span>1</span></a></li>
		
			<li><a href="/categories/数据库/">数据库<span>1</span></a></li>
		
			<li><a href="/categories/数据结构与算法/">数据结构与算法<span>1</span></a></li>
		
			<li><a href="/categories/机器学习/">机器学习<span>6</span></a></li>
		
			<li><a href="/categories/系统架构/">系统架构<span>1</span></a></li>
		
			<li><a href="/categories/经验心得/">经验心得<span>3</span></a></li>
		
			<li><a href="/categories/设计模式/">设计模式<span>4</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/Docker/">Docker<span>1</span></a></li>
		
			<li><a href="/tags/系统架构/">系统架构<span>1</span></a></li>
		
			<li><a href="/tags/Java/">Java<span>11</span></a></li>
		
			<li><a href="/tags/Python/">Python<span>1</span></a></li>
		
			<li><a href="/tags/经验心得/">经验心得<span>4</span></a></li>
		
			<li><a href="/tags/泛型/">泛型<span>1</span></a></li>
		
			<li><a href="/tags/Web开发/">Web开发<span>1</span></a></li>
		
			<li><a href="/tags/Java虚拟机/">Java虚拟机<span>1</span></a></li>
		
			<li><a href="/tags/框架/">框架<span>1</span></a></li>
		
			<li><a href="/tags/图像处理/">图像处理<span>1</span></a></li>
		
			<li><a href="/tags/数据结构与算法/">数据结构与算法<span>1</span></a></li>
		
			<li><a href="/tags/机器学习/">机器学习<span>6</span></a></li>
		
			<li><a href="/tags/数据库/">数据库<span>1</span></a></li>
		
			<li><a href="/tags/Linux/">Linux<span>1</span></a></li>
		
			<li><a href="/tags/设计模式/">设计模式<span>4</span></a></li>
		
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2020/06/08/《高效能人士的七个习惯》读书笔记/"  title="《高效能人士的七个习惯》读书笔记" ><i class="fa fa-file-o"></i>《高效能人士的七个习惯》读书笔记</a>
      </li>
    
      <li>
        <a href="/2020/04/20/数据库性能优化分析/"  title="最近负责考虑自己所在项目的数据库性能优化方案，主要是一张大表 **table_a**，预计上线以后会有亿级甚至十亿级数据，需要解决单表数据量过大所带来的性能和管理问题。本文对常用数据库优化方法进行整理、分析和总结，最终给出了适合本项目的数据库优化方案。" ><i class="fa fa-file-o"></i>数据库性能优化方法专题分析</a>
      </li>
    
      <li>
        <a href="/2018/09/13/win10上PyCharm选择本地docker镜像中解释器报NullPointerException解决方案/"  title="在win10中使用PyCharm进行Python开发，通过Docker搭建本地开发环境会比较方便。我在这个过程中遇到了一个纠结了很久的问题，docker-machine启动后，在PyCharm中选择项目解释器时会报异常，同时PyCharm中会显示docker-machine没有运行。" ><i class="fa fa-file-o"></i>win10上PyCharm选择本地docker镜像中解...</a>
      </li>
    
      <li>
        <a href="/2018/06/01/磁盘分区与Ext2文件系统/"  title="磁盘分区与Linux的Ext2文件系统简介。" ><i class="fa fa-file-o"></i>磁盘分区与Ext2文件系统</a>
      </li>
    
      <li>
        <a href="/2017/09/04/FreeMarker模板引擎实战/"  title="FreeMarker是一个模板引擎：它是一个Java库，基于模板和要改变的数据生成输出文本（HTML网页、电子邮件、配置文件、源代码等）。本文通过一个小demo来说明FreeMarker的使用方式。" ><i class="fa fa-file-o"></i>FreeMarker模板引擎实战</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/wzpan/freemind/" title="Freemind's Github repository." target="_blank"]);">Freemind</a></li>
	
		<li><i class="fa fa-github"></i><a href="http://www.github.com/wzpan" title="My Github account." target="_blank"]);">My Github</a></li>
	
		<li><i class="fa fa-linkedin"></i><a href="http://www.linkedin.com/in/hahack" title="My Linkin account." target="_blank"]);">My LinkedIn</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->




    </div>
  </div>
  <div class="container-narrow">
    <footer> <p>
  &copy; 2020 Aaron Wu
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
  </div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




<!-- syntax highlighting -->

  <script>
  marked.setOptions({
    highlight: function (code, lang) {
        return hljs.highlightAuto(code).value;
    }
  });
  function Highlighting(){
    var markdowns = document.getElementsByClassName('markdown');
    for(var i=0;i<markdowns.length;i++){
        if(markdowns[i].innerHTML) markdowns[i].innerHTML =marked(markdowns[i].innerHTML);
    }
  }
  window.addEventListener('DOMContentLoaded', Highlighting, false);
  window.addEventListener('load', Highlighting, false);
  </script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


</body>
</html>